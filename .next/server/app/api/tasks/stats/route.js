(()=>{var e={};e.id=75,e.ids=[75],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},7725:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>y,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>c});var s=r(2706),n=r(8203),o=r(5994),i=r(9187),d=r(9995);async function c(e){try{let t;let{searchParams:r}=new URL(e.url),a=r.get("weekStart");t=a?await d.O.getTasksByWeek(a):await d.O.getTasks();let s=await d.O.getTaskStats(t);return i.NextResponse.json(s)}catch(e){return console.error("Error fetching task stats:",e),i.NextResponse.json({error:"Failed to fetch task stats"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/tasks/stats/route",pathname:"/api/tasks/stats",filename:"route",bundlePath:"app/api/tasks/stats/route"},resolvedPagePath:"/Users/mati/Documents/proyectos/TRAE/src/app/api/tasks/stats/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:y}=u;function g(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}},6487:()=>{},8335:()=>{},9995:(e,t,r)=>{"use strict";r.d(t,{O:()=>d});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient({log:["query"]}),n={formatDate:e=>e.toISOString().split("T")[0],getWeekStart:e=>{let t=new Date(e),r=t.getDay(),a=t.getDate()-r+(0===r?-6:1);return new Date(t.setDate(a))},addDays:(e,t)=>{let r=new Date(e);return r.setDate(r.getDate()+t),r},addWeeks:(e,t)=>n.addDays(e,7*t),getWeekInfo:e=>{let t=n.getWeekStart(e),r=n.addDays(t,6),a=new Date(t.getFullYear(),0,1),s=Math.ceil(((t.getTime()-a.getTime())/864e5+a.getDay()+1)/7),o=[];for(let e=0;e<7;e++){let r=n.addDays(t,e);o.push({date:r,dayName:n.getDayName(e),dayNumber:r.getDate(),monthName:r.toLocaleDateString("es-ES",{month:"long"})})}return{weekStart:t,weekEnd:r,weekNumber:s,year:t.getFullYear(),days:o}},getDayName:e=>["monday","tuesday","wednesday","thursday","friday","saturday","sunday"][e],isSameWeek:(e,t)=>{let r=n.getWeekStart(e),a=n.getWeekStart(t);return r.getTime()===a.getTime()}},o=e=>({id:e.id,title:e.title,completed:e.completed,priority:e.priority.toLowerCase(),category:e.category?.toLowerCase()||"other",day:e.day,date:e.date,createdAt:e.createdAt,updatedAt:e.updatedAt}),i=e=>{let t={...e};return e.priority&&(t.priority=e.priority.toUpperCase()),delete t.id,delete t.createdAt,delete t.updatedAt,t},d={async getTasks(){try{return(await s.task.findMany({orderBy:[{date:"asc"},{createdAt:"asc"}]})).map(o)}catch(e){return console.error("Error fetching tasks:",e),[]}},async createTask(e,t,r,a="medium",n="other"){try{let i=await s.task.create({data:{title:e,day:t,date:r,priority:a.toUpperCase(),category:n.toUpperCase(),completed:!1}});return o(i)}catch(e){return console.error("Error creating task:",e),null}},async updateTask(e,t){try{let r=await s.task.update({where:{id:e},data:i(t)});return o(r)}catch(e){return console.error("Error updating task:",e),null}},async deleteTask(e){try{return await s.task.delete({where:{id:e}}),!0}catch(e){return console.error("Error deleting task:",e),!1}},async getTasksByDate(e){try{return(await s.task.findMany({where:{date:e},orderBy:{createdAt:"asc"}})).map(o)}catch(e){return console.error("Error fetching tasks by date:",e),[]}},async getTasksByWeek(e){try{let t=new Date(e),r=n.addDays(t,6);return(await s.task.findMany({where:{date:{gte:n.formatDate(t),lte:n.formatDate(r)}},orderBy:[{date:"asc"},{createdAt:"asc"}]})).map(o)}catch(e){return console.error("Error fetching tasks by week:",e),[]}},async toggleTask(e){try{let t=await s.task.findUnique({where:{id:e}});if(!t)return null;let r=await s.task.update({where:{id:e},data:{completed:!t.completed}});return o(r)}catch(e){return console.error("Error toggling task:",e),null}},async getTaskStats(e){let t=e;t||(t=await this.getTasks());let r=t.length,a=t.filter(e=>e.completed).length,s=r>0?Math.round(a/r*100):0;return{total:r,completed:a,pending:r-a,completionRate:s}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,452],()=>r(7725));module.exports=a})();