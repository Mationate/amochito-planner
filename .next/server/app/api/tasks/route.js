(()=>{var e={};e.id=456,e.ids=[456],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2927:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{DELETE:()=>y,GET:()=>u,POST:()=>d,PUT:()=>l});var n=r(2706),s=r(8203),o=r(5994),i=r(9187),c=r(2193);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("date"),a=t.get("weekStart");t.get("weekEnd");let n=t.get("monthStart"),s=t.get("monthEnd"),o=t.get("completed");if(r){let e=await c.O.getTasksByDate(r);return i.NextResponse.json(e)}if(a){let e=await c.O.getTasksByWeek(a);return i.NextResponse.json(e)}if(n&&s){let e=await c.O.getTasksByMonth(n,s,"true"===o);return i.NextResponse.json(e)}let u=await c.O.getTasks();return i.NextResponse.json(u)}catch(e){return console.error("Error fetching tasks:",e),i.NextResponse.json({error:"Failed to fetch tasks"},{status:500})}}async function d(e){try{let{title:t,day:r,priority:a,date:n,category:s}=await e.json();if(!t||!r||!a||!n||!s)return i.NextResponse.json({error:"Missing required fields"},{status:400});let o=await c.O.createTask(t,r,n,a,s);return i.NextResponse.json(o,{status:201})}catch(e){return console.error("Error creating task:",e),i.NextResponse.json({error:"Failed to create task"},{status:500})}}async function l(e){try{let{id:t,...r}=await e.json();if(!t)return i.NextResponse.json({error:"Task ID is required"},{status:400});let a=await c.O.updateTask(t,r);return i.NextResponse.json(a)}catch(e){return console.error("Error updating task:",e),i.NextResponse.json({error:"Failed to update task"},{status:500})}}async function y(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"Task ID is required"},{status:400});return await c.O.deleteTask(r),i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting task:",e),i.NextResponse.json({error:"Failed to delete task"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/tasks/route",pathname:"/api/tasks",filename:"route",bundlePath:"app/api/tasks/route"},resolvedPagePath:"/Users/mati/Documents/proyectos/TRAE/src/app/api/tasks/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:h}=p;function k(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}},6487:()=>{},8335:()=>{},2193:(e,t,r)=>{"use strict";r.d(t,{O:()=>c});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient({log:["query"]});var s=r(2963);let o=e=>({id:e.id,title:e.title,completed:e.completed,priority:e.priority.toLowerCase(),category:e.category?.toLowerCase()||"other",day:e.day,date:e.date,createdAt:e.createdAt,updatedAt:e.updatedAt}),i=e=>{let t={...e};return e.priority&&(t.priority=e.priority.toUpperCase()),e.category&&(t.category=e.category.toUpperCase()),delete t.id,delete t.createdAt,delete t.updatedAt,t},c={async getTasks(){try{return(await n.task.findMany({orderBy:[{date:"asc"},{createdAt:"asc"}]})).map(o)}catch(e){return console.error("Error fetching tasks:",e),[]}},async createTask(e,t,r,a="medium",s="other"){try{let i=await n.task.create({data:{title:e,day:t,date:r,priority:a.toUpperCase(),category:s.toUpperCase(),completed:!1}});return o(i)}catch(e){return console.error("Error creating task:",e),null}},async updateTask(e,t){try{let r=await n.task.update({where:{id:e},data:i(t)});return o(r)}catch(e){return console.error("Error updating task:",e),null}},async deleteTask(e){try{return await n.task.delete({where:{id:e}}),!0}catch(e){return console.error("Error deleting task:",e),!1}},async getTasksByDate(e){try{return(await n.task.findMany({where:{date:e},orderBy:{createdAt:"asc"}})).map(o)}catch(e){return console.error("Error fetching tasks by date:",e),[]}},async getTasksByWeek(e){try{let t=new Date(e),r=s.s.addDays(t,6);return(await n.task.findMany({where:{date:{gte:s.s.formatDate(t),lte:s.s.formatDate(r)}},orderBy:[{date:"asc"},{createdAt:"asc"}]})).map(o)}catch(e){return console.error("Error fetching tasks by week:",e),[]}},async toggleTask(e){try{let t=await n.task.findUnique({where:{id:e}});if(!t)return null;let r=await n.task.update({where:{id:e},data:{completed:!t.completed}});return o(r)}catch(e){return console.error("Error toggling task:",e),null}},async getTasksByMonth(e,t,r=!1){try{let a={date:{gte:e,lte:t}};return r&&(a.completed=!0),(await n.task.findMany({where:a,orderBy:[{date:"asc"},{createdAt:"asc"}]})).map(o)}catch(e){return console.error("Error fetching tasks by month:",e),[]}},async getTaskStats(e){let t=e;t||(t=await this.getTasks());let r=t.length,a=t.filter(e=>e.completed).length,n=r>0?Math.round(a/r*100):0;return{total:r,completed:a,pending:r-a,completionRate:n}},async createNotificationConfig(e,t,r){try{return await n.notificationConfig.create({data:{email:e,time:t,jobId:r,isActive:!0}})}catch(e){return console.error("Error creando configuraci\xf3n de notificaci\xf3n:",e),null}},async updateNotificationConfig(e,t){try{return await n.notificationConfig.update({where:{email:e},data:t})}catch(e){return console.error("Error actualizando configuraci\xf3n de notificaci\xf3n:",e),null}},async getNotificationConfig(e){try{return await n.notificationConfig.findUnique({where:{email:e}})}catch(e){return console.error("Error obteniendo configuraci\xf3n de notificaci\xf3n:",e),null}},async getAllActiveNotificationConfigs(){try{return await n.notificationConfig.findMany({where:{isActive:!0}})}catch(e){return console.error("Error obteniendo configuraciones activas:",e),[]}},async deleteNotificationConfig(e){try{return await n.notificationConfig.delete({where:{email:e}}),!0}catch(e){return console.error("Error eliminando configuraci\xf3n de notificaci\xf3n:",e),!1}},async deactivateNotificationConfig(e){try{return await n.notificationConfig.update({where:{email:e},data:{isActive:!1}})}catch(e){return console.error("Error desactivando configuraci\xf3n de notificaci\xf3n:",e),null}},async getUserPreferences(e){try{return await n.userPreferences.findUnique({where:{userId:e}})}catch(e){return console.error("Error obteniendo preferencias de usuario:",e),null}},async createUserPreferences(e,t="system",r="default"){try{return await n.userPreferences.create({data:{userId:e,theme:t,colorTheme:r}})}catch(e){return console.error("Error creando preferencias de usuario:",e),null}},async updateUserPreferences(e,t){try{return await n.userPreferences.upsert({where:{userId:e},update:t,create:{userId:e,theme:t.theme||"system",colorTheme:t.colorTheme||"default"}})}catch(e){return console.error("Error actualizando preferencias de usuario:",e),null}},async deleteUserPreferences(e){try{return await n.userPreferences.delete({where:{userId:e}}),!0}catch(e){return console.error("Error eliminando preferencias de usuario:",e),!1}}}},2963:(e,t,r)=>{"use strict";r.d(t,{s:()=>a});let a={formatDate:e=>e.toISOString().split("T")[0],getWeekStart:e=>{let t=new Date(e),r=t.getDay(),a=t.getDate()-r+(0===r?-6:1),n=new Date(t);return n.setDate(a),n},addDays:(e,t)=>{let r=new Date(e);return r.setDate(r.getDate()+t),r},addWeeks:(e,t)=>a.addDays(e,7*t),getWeekInfo:e=>{let t=a.getWeekStart(e),r=a.addDays(t,6),n=new Date(t.getFullYear(),0,1),s=Math.ceil(((t.getTime()-n.getTime())/864e5+n.getDay()+1)/7),o=[];for(let e=0;e<7;e++){let r=a.addDays(t,e);o.push({date:r,dayName:a.getDayName(e),dayNumber:r.getDate(),monthName:r.toLocaleDateString("es-ES",{month:"long"})})}return{weekStart:t,weekEnd:r,weekNumber:s,year:t.getFullYear(),days:o}},getDayName:e=>["monday","tuesday","wednesday","thursday","friday","saturday","sunday"][e],isSameWeek:(e,t)=>{let r=a.getWeekStart(e),n=a.getWeekStart(t);return r.getTime()===n.getTime()}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,452],()=>r(2927));module.exports=a})();